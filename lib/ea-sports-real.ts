// NOUVELLE IMPL√âMENTATION AVEC LA VRAIE LIBRAIRIE EAFC-CLUBS-API\n// Bas√©e sur ClubStats Pro qui fonctionne parfaitement\n\nconst { EAFCApiService } = require('eafc-clubs-api');\n\n// Cr√©er une instance du service\nconst api = new EAFCApiService();\n\n// Mapping des plateformes pour l'API EA\nconst PLATFORM_MAP = {\n  'ps5': 'common-gen5',\n  'ps4': 'common-gen4',\n  'xboxseriesxs': 'common-gen5',\n  'xboxone': 'common-gen4',\n  'pc': 'common-gen5',\n};\n\n// Types pour compatibilit√©\nexport interface ClubMatchData {\n  id?: string;\n  matchId?: string;\n  opponent: string;\n  scoreFor: number;\n  scoreAgainst: number;\n  date: Date;\n  result: 'win' | 'draw' | 'loss';\n  competition?: string;\n  myScore?: number;\n  opponentScore?: number;\n}\n\nexport interface ClubInfoData {\n  id: string;\n  name: string;\n  platform: string;\n  members?: any[];\n}\n\nexport interface EAPlayerStatsData {\n  playerId: string;\n  playerName: string;\n  position: string;\n  matchesPlayed: number;\n  minutesPlayed: number;\n  averageRating: number;\n  goals: number;\n  assists: number;\n  shots: number;\n  shotsOnTarget: number;\n  shotAccuracy: number;\n  dribbles: number;\n  dribbleSuccess: number;\n  crosses: number;\n  crossAccuracy: number;\n  corners: number;\n  freekicks: number;\n  penalties: number;\n  penaltiesScored: number;\n  tackles: number;\n  tackleSuccess: number;\n  interceptions: number;\n  clearances: number;\n  blocks: number;\n  aerialDuelsWon: number;\n  aerialDuelsTotal: number;\n  foulsCommitted: number;\n  foulsWon: number;\n  saves: number;\n  goalsConceded: number;\n  cleanSheets: number;\n  catches: number;\n  punches: number;\n  distributions: number;\n  distributionSuccess: number;\n  penaltiesSaved: number;\n  penaltiesFaced: number;\n  distanceRun: number;\n  topSpeed: number;\n  sprints: number;\n  yellowCards: number;\n  redCards: number;\n  manOfTheMatch: number;\n  passesCompleted: number;\n  passesAttempted: number;\n  passAccuracy: number;\n  longPasses: number;\n  longPassAccuracy: number;\n  throughBalls: number;\n  keyPasses: number;\n  form: number;\n  consistency: number;\n  clutchGoals: number;\n}\n\nexport interface EAClubCompleteData {\n  clubId: string;\n  clubName: string;\n  platform: string;\n  division: string;\n  rank: number;\n  points: number;\n  wins: number;\n  draws: number;\n  losses: number;\n  goalsFor: number;\n  goalsAgainst: number;\n  players: EAPlayerStatsData[];\n  recentMatches: ClubMatchData[];\n  lastUpdated: Date;\n  seasonYear: string;\n}\n\n/**\n * üî• VRAIE FONCTION - R√©cup√®re les d√©tails complets d'un match sp√©cifique avec les stats des joueurs\n * Utilise la vraie librairie eafc-clubs-api comme ClubStats Pro\n */\nexport async function fetchClubMatchDetails(matchId: string, platform: string): Promise<any> {\n  console.log(`üîç R√©cup√©ration d√©tails match: ${matchId} (${platform}) - VRAIE LIBRAIRIE`);\n  \n  try {\n    const apiPlatform = PLATFORM_MAP[platform as keyof typeof PLATFORM_MAP] || 'common-gen5';\n    \n    // üî• UTILISER LA VRAIE M√âTHODE DE L'API\n    const matchDetails = await api.matchDetails({\n      matchId: matchId,\n      platform: apiPlatform\n    });\n    \n    console.log(`‚úÖ D√©tails du match r√©cup√©r√©s avec la vraie librairie`);\n    \n    // V√©rifier que les donn√©es des joueurs sont pr√©sentes\n    if (matchDetails && matchDetails.players) {\n      const totalPlayers = Object.keys(matchDetails.players).reduce((sum, clubId) => {\n        return sum + Object.keys(matchDetails.players[clubId] || {}).length;\n      }, 0);\n      console.log(`üë• ${totalPlayers} joueurs trouv√©s dans les d√©tails du match`);\n    }\n    \n    return matchDetails;\n    \n  } catch (error: any) {\n    console.error(`‚ùå Erreur r√©cup√©ration d√©tails match ${matchId}:`, error);\n    throw error;\n  }\n}\n\n/**\n * üî• VRAIE FONCTION - R√©cup√®re les informations COMPLETES d'un club EA Sports avec ses membres\n * Utilise la vraie librairie eafc-clubs-api comme ClubStats Pro\n */\nexport async function fetchClubInfo(clubId: string, platform: string): Promise<ClubInfoData | null> {\n  console.log(`üîç R√©cup√©ration infos COMPLETES club EA: ${clubId} (${platform}) - VRAIE LIBRAIRIE`);\n  \n  try {\n    const apiPlatform = PLATFORM_MAP[platform as keyof typeof PLATFORM_MAP] || 'common-gen5';\n    \n    // üî• UTILISER LA VRAIE M√âTHODE DE L'API\n    const response = await api.clubInfo({\n      clubIds: clubId,\n      platform: apiPlatform\n    });\n    \n    console.log(`‚úÖ R√©ponse API EA Sports club info re√ßue avec la vraie librairie`);\n    \n    // L'API retourne un objet avec les clubs index√©s par ID\n    const clubInfo = response[clubId];\n    if (!clubInfo) {\n      console.log(`‚ùå Club ${clubId} non trouv√© dans la r√©ponse API`);\n      return null;\n    }\n    \n    console.log(`‚úÖ Club trouv√©: \"${clubInfo.name}\"`);\n    \n    // R√©cup√©rer les membres du club si disponibles\n    let members = [];\n    try {\n      const memberStats = await api.memberCareerStats({\n        clubId: clubId,\n        platform: apiPlatform\n      });\n      \n      if (memberStats && memberStats.members) {\n        members = Object.values(memberStats.members).map((member: any) => ({\n          name: member.name,\n          position: member.favoritePosition || 'ATT',\n          overall: member.ratingAve || 0,\n          isActive: true,\n          playerId: member.playerId || member.name.replace(/\\s+/g, '_')\n        }));\n        console.log(`üë• ${members.length} membres trouv√©s pour le club`);\n      }\n    } catch (memberError) {\n      console.log(`‚ö†Ô∏è  Impossible de r√©cup√©rer les membres: ${memberError}`);\n    }\n    \n    return {\n      id: clubId,\n      name: clubInfo.name || `Club ${clubId}`,\n      platform: platform,\n      members: members\n    };\n    \n  } catch (error: any) {\n    console.error(`‚ùå Erreur r√©cup√©ration infos club ${clubId}:`, error);\n    \n    // Fallback sur les noms hardcod√©s\n    const clubNames: { [key: string]: string } = {\n      '40142': 'HOF 221',\n      '24000': 'BUUR MFC', \n      '29739': 'NEK BI',\n      '460504': 'FC BOUNDOUXATAL',\n      '46871': 'HEMLE FC',\n      '1039553': 'ASC GALGUI'\n    };\n    \n    const name = clubNames[clubId] || `Club ${clubId}`;\n    return { id: clubId, name: name, platform: platform };\n  }\n}\n\n/**\n * üî• VRAIE FONCTION - R√©cup√®re les derniers matchs d'un club EA Sports\n * Utilise la vraie librairie eafc-clubs-api comme ClubStats Pro\n */\nexport async function fetchClubMatches(clubId: string, platform: string, limit: number = 10): Promise<ClubMatchData[]> {\n  console.log(`‚öΩ R√©cup√©ration matchs club EA: ${clubId} (${platform}) - VRAIE LIBRAIRIE`);\n  \n  try {\n    const apiPlatform = PLATFORM_MAP[platform as keyof typeof PLATFORM_MAP] || 'common-gen5';\n    \n    // üî• UTILISER LA VRAIE M√âTHODE DE L'API - R√©cup√©rer diff√©rents types de matchs\n    const matchTypes = ['leagueMatch', 'friendlyMatch', 'playoffMatch'];\n    const allMatches: any[] = [];\n    const matchIds = new Set<string>();\n    \n    for (const matchType of matchTypes) {\n      console.log(`üîó Appel API EA: ${matchType}`);\n      \n      try {\n        const matches = await api.matchesStats({\n          clubIds: clubId,\n          platform: apiPlatform,\n          matchType: matchType\n        });\n        \n        if (Array.isArray(matches)) {\n          // Ajouter uniquement les matchs uniques\n          matches.forEach((match: any) => {\n            if (match.matchId && !matchIds.has(match.matchId)) {\n              matchIds.add(match.matchId);\n              allMatches.push({ ...match, matchType });\n            }\n          });\n          console.log(`  ‚úÖ ${matchType}: ${matches.length} matchs r√©cup√©r√©s`);\n        }\n      } catch (error: any) {\n        console.log(`  ‚ö†Ô∏è  ${matchType}: ${error.message}`);\n      }\n    }\n    \n    console.log(`üìä Total unique matches: ${allMatches.length}`);\n    \n    // Convertir au format ClubMatchData (limiter aux plus r√©cents)\n    const matches = allMatches.slice(0, limit).map((match: any) => {\n      const clubIds = Object.keys(match.clubs || {});\n      const opponentId = clubIds.find(id => id !== clubId);\n      \n      if (!opponentId) return null;\n\n      const myClub = match.clubs[clubId];\n      const opponentClub = match.clubs[opponentId];\n\n      const scoreFor = parseInt(myClub?.goals) || 0;\n      const scoreAgainst = parseInt(opponentClub?.goals) || 0;\n\n      let result: 'win' | 'draw' | 'loss';\n      if (scoreFor > scoreAgainst) {\n        result = 'win';\n      } else if (scoreFor < scoreAgainst) {\n        result = 'loss';\n      } else {\n        result = 'draw';\n      }\n\n      return {\n        matchId: match.matchId,\n        opponent: opponentClub?.details?.name || '√âquipe inconnue',\n        scoreFor,\n        scoreAgainst,\n        myScore: scoreFor, // Alias pour compatibility\n        opponentScore: scoreAgainst, // Alias pour compatibility\n        result,\n        date: new Date(match.timestamp * 1000),\n        competition: match.matchType === 'friendlyMatch' ? 'Friendly' \n                   : match.matchType === 'playoffMatch' ? 'Playoff'\n                   : 'League'\n      };\n    }).filter(Boolean) as ClubMatchData[];\n\n    console.log(`‚úÖ ${matches.length} matchs r√©cup√©r√©s avec succ√®s pour ${clubId}`);\n    return matches;\n\n  } catch (error: any) {\n    console.error(`‚ùå Erreur r√©cup√©ration matchs ${clubId}:`, error);\n    return [];\n  }\n}\n\n/**\n * üî• VRAIE FONCTION - R√©cup√®re les statistiques COMPLETES d'un club EA Sports (joueurs + stats)\n * Utilise la vraie librairie eafc-clubs-api comme ClubStats Pro\n */\nexport async function fetchCompleteClubStats(\n  clubId: string, \n  platform: string\n): Promise<EAClubCompleteData | null> {\n  \n  console.log(`üéØ === R√âCUP√âRATION COMPLETE CLUB ${clubId} (${platform}) - VRAIE LIBRAIRIE ===`);\n  \n  try {\n    const apiPlatform = PLATFORM_MAP[platform as keyof typeof PLATFORM_MAP] || 'common-gen5';\n    \n    // R√©cup√©rer les infos de base du club\n    const clubInfo = await fetchClubInfo(clubId, platform);\n    if (!clubInfo) {\n      console.log(`‚ùå Infos de base du club ${clubId} non disponibles`);\n      return null;\n    }\n    \n    console.log(`üìà Traitement des stats du club \"${clubInfo.name}\"`);\n    \n    // üî• UTILISER LA VRAIE M√âTHODE DE L'API - R√©cup√©rer les stats des membres\n    const players: EAPlayerStatsData[] = [];\n    \n    try {\n      const memberStats = await api.memberCareerStats({\n        clubId: clubId,\n        platform: apiPlatform\n      });\n      \n      if (memberStats && memberStats.members) {\n        console.log(`üë• ${Object.keys(memberStats.members).length} membres avec stats trouv√©s`);\n        \n        for (const [playerId, member] of Object.entries(memberStats.members as any)) {\n          const playerData: EAPlayerStatsData = {\n            playerId: playerId || member.name?.replace(/\\s+/g, '_'),\n            playerName: member.name || 'Joueur Inconnu',\n            position: member.favoritePosition || 'ATT',\n            matchesPlayed: member.gamesPlayed || 0,\n            minutesPlayed: (member.gamesPlayed || 0) * 90, // Estimation\n            averageRating: member.ratingAve || 0,\n            \n            // Stats offensives\n            goals: member.goals || 0,\n            assists: member.assists || 0,\n            shots: member.shots || 0,\n            shotsOnTarget: member.shotsOnTarget || 0,\n            shotAccuracy: member.shotsOnTarget && member.shots ? \n              Math.round((member.shotsOnTarget / member.shots) * 100) : 0,\n            dribbles: member.dribbles || 0,\n            dribbleSuccess: member.dribbleSuccess || 0,\n            crosses: member.crosses || 0,\n            crossAccuracy: member.crossAccuracy || 0,\n            corners: member.corners || 0,\n            freekicks: member.freekicks || 0,\n            penalties: member.penalties || 0,\n            penaltiesScored: member.penaltiesScored || 0,\n            \n            // Stats d√©fensives\n            tackles: member.tackles || 0,\n            tackleSuccess: member.tackleSuccess || 0,\n            interceptions: member.interceptions || 0,\n            clearances: member.clearances || 0,\n            blocks: member.blocks || 0,\n            aerialDuelsWon: member.aerialDuelsWon || 0,\n            aerialDuelsTotal: member.aerialDuelsTotal || 0,\n            foulsCommitted: member.foulsCommitted || 0,\n            foulsWon: member.foulsWon || 0,\n            \n            // Stats gardien\n            saves: member.saves || 0,\n            goalsConceded: member.goalsConceded || 0,\n            cleanSheets: member.cleanSheets || 0,\n            catches: member.catches || 0,\n            punches: member.punches || 0,\n            distributions: member.distributions || 0,\n            distributionSuccess: member.distributionSuccess || 0,\n            penaltiesSaved: member.penaltiesSaved || 0,\n            penaltiesFaced: member.penaltiesFaced || 0,\n            \n            // Stats physiques & passes\n            distanceRun: member.distanceRun || 0,\n            topSpeed: member.topSpeed || 0,\n            sprints: member.sprints || 0,\n            passesCompleted: member.passesCompleted || 0,\n            passesAttempted: member.passesAttempted || 0,\n            passAccuracy: member.passesCompleted && member.passesAttempted ?\n              Math.round((member.passesCompleted / member.passesAttempted) * 100) : 0,\n            longPasses: member.longPasses || 0,\n            longPassAccuracy: member.longPassAccuracy || 0,\n            throughBalls: member.throughBalls || 0,\n            keyPasses: member.keyPasses || 0,\n            \n            // Discipline & r√©compenses\n            yellowCards: member.yellowCard || 0,\n            redCards: member.redCard || 0,\n            manOfTheMatch: member.manOfTheMatch || 0,\n            \n            // Stats de performance\n            form: member.form || 0,\n            consistency: member.consistency || 0,\n            clutchGoals: member.clutchGoals || 0\n          };\n          \n          players.push(playerData);\n          console.log(`  ‚úÖ ${playerData.playerName}: ${playerData.goals} buts, ${playerData.assists} passes, note ${playerData.averageRating}`);\n        }\n      } else {\n        console.log(`‚ö†Ô∏è  Pas de membres avec stats pour le club ${clubId}`);\n      }\n    } catch (memberError) {\n      console.error(`‚ùå Erreur r√©cup√©ration stats membres: ${memberError}`);\n    }\n    \n    // R√©cup√©rer les matchs r√©cents\n    const recentMatches = await fetchClubMatches(clubId, platform, 10);\n    \n    // Construire les stats du club\n    const clubCompleteData: EAClubCompleteData = {\n      clubId: clubInfo.id,\n      clubName: clubInfo.name,\n      platform: platform,\n      division: 'Ligue S√©n√©galaise',\n      rank: 0,\n      points: 0,\n      wins: 0,\n      draws: 0,\n      losses: 0,\n      goalsFor: players.reduce((sum, p) => sum + p.goals, 0),\n      goalsAgainst: 0,\n      players: players,\n      recentMatches: recentMatches,\n      lastUpdated: new Date(),\n      seasonYear: new Date().getFullYear().toString()\n    };\n    \n    console.log(`üéâ === R√âCUP√âRATION TERMIN√âE ===`);\n    console.log(`üìà R√©sum√© pour \"${clubInfo.name}\": ${players.length} joueurs, ${clubCompleteData.goalsFor} buts`);\n    \n    return clubCompleteData;\n    \n  } catch (error: any) {\n    console.error(`‚ùå Erreur r√©cup√©ration stats compl√®tes club ${clubId}:`, error);\n    return null;\n  }\n}\n\n/**\n * üî• VRAIE FONCTION - D√©termine si deux clubs se sont affront√©s r√©cemment\n * Utilise les donn√©es des vraies APIs\n */\nexport function findInterClubMatch(\n  club1Matches: ClubMatchData[], \n  club2Matches: ClubMatchData[],\n  club1Name: string,\n  club2Name: string\n): ClubMatchData | null {\n  console.log(`üîç Recherche match inter-clubs: \"${club1Name}\" vs \"${club2Name}\"`);\n  \n  // Chercher un match o√π club1 a jou√© contre club2 (par nom d'adversaire)\n  for (const match of club1Matches) {\n    // Normaliser les noms pour la comparaison\n    const opponentName = match.opponent.toLowerCase().trim();\n    const searchName = club2Name.toLowerCase().trim();\n    \n    // V√©rification exacte ou partielle du nom\n    if (opponentName === searchName || \n        opponentName.includes(searchName) || \n        searchName.includes(opponentName)) {\n      \n      console.log(`‚úÖ Match trouv√©: ${club1Name} vs ${match.opponent} (${match.scoreFor}-${match.scoreAgainst})`);\n      return match;\n    }\n  }\n  \n  // Chercher dans l'autre sens (club2 contre club1)\n  for (const match of club2Matches) {\n    const opponentName = match.opponent.toLowerCase().trim();\n    const searchName = club1Name.toLowerCase().trim();\n    \n    if (opponentName === searchName || \n        opponentName.includes(searchName) || \n        searchName.includes(opponentName)) {\n      \n      // Inverser le r√©sultat puisque c'est du point de vue de club2\n      let invertedResult: 'win' | 'draw' | 'loss';\n      if (match.result === 'win') invertedResult = 'loss';\n      else if (match.result === 'loss') invertedResult = 'win';\n      else invertedResult = 'draw';\n      \n      const invertedMatch: ClubMatchData = {\n        ...match,\n        opponent: club2Name,\n        scoreFor: match.scoreAgainst,\n        scoreAgainst: match.scoreFor,\n        result: invertedResult\n      };\n      \n      console.log(`‚úÖ Match trouv√© (invers√©): ${club1Name} vs ${club2Name} (${invertedMatch.scoreFor}-${invertedMatch.scoreAgainst})`);\n      return invertedMatch;\n    }\n  }\n  \n  console.log(`‚ùå Aucun match trouv√© entre \"${club1Name}\" et \"${club2Name}\"`);\n  return null;\n}\n\n/**\n * V√©rifie si un club existe et est accessible via l'API EA\n */\nexport async function validateClub(clubId: string, platform: string): Promise<boolean> {\n  const clubInfo = await fetchClubInfo(clubId, platform);\n  return clubInfo !== null;\n}\n\nconsole.log('‚úÖ EA Sports API - VRAIE LIBRAIRIE CHARG√âE (eafc-clubs-api)');\n